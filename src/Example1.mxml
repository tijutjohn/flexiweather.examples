<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical"
		xmlns:widgets="com.iblsoft.flexiweather.widgets.*"
		creationComplete="onCreationComplete(event)">
	<mx:Script>
		<![CDATA[
			import com.iblsoft.flexiweather.widgets.InteractiveLayerZoom;
			import com.iblsoft.flexiweather.widgets.InteractiveLayerPan;
			import mx.controls.Alert;
			import com.iblsoft.flexiweather.ogc.InteractiveLayerWMS;
			import com.iblsoft.flexiweather.ogc.OGCServiceConfigurationManager;
			import com.iblsoft.flexiweather.ogc.Version;
			import com.iblsoft.flexiweather.ogc.WMSLayerConfiguration;
			import com.iblsoft.flexiweather.ogc.WMSServiceConfiguration;

			private function onCreationComplete(event: Event): void
			{
            	var scm: OGCServiceConfigurationManager =
            			OGCServiceConfigurationManager.getInstance();

    			var srv: WMSServiceConfiguration = scm.getService(
    					"https://ogcie.iblsoft.com/ria", new Version(1, 3, 0),
						WMSServiceConfiguration) as WMSServiceConfiguration;

    			var srv2: WMSServiceConfiguration = scm.getService(
    					"https://ogcie.iblsoft.com/obs?STATION_MODEL_ZOOM=0.9", new Version(1, 3, 0),
						WMSServiceConfiguration) as WMSServiceConfiguration;
				srv2.updatePeriod = 5*60*1000;
				
				var lc: WMSLayerConfiguration;
				var l: InteractiveLayerWMS;
				lc = new WMSLayerConfiguration(srv, ["background-dem"]);
				lc.label = "Backgrounds/DEM";
				l = new InteractiveLayerWMS(m_iw, lc);
				l.setWMSStyleName(0, "white-colours");
				m_iw.addLayer(l);
				l.refresh(true);

				lc = new WMSLayerConfiguration(srv2, ["METAR"]);
				lc.label = "METAR";
				l = new InteractiveLayerWMS(m_iw, lc);
				m_iw.addLayer(l);
				l.refresh(true);

				lc = new WMSLayerConfiguration(srv, ["foreground-lines"]);
				lc.label = "Overlays/Border lines";
				l = new InteractiveLayerWMS(m_iw, lc);
				m_iw.addLayer(l);
				l.refresh(true);
				
			}
		]]>
	</mx:Script>
	<mx:Label text="This example demonstrates basic OpenGIS WMS functionality, zooming, panning and change of projection reference system"/>
	<mx:HBox>
		<mx:Label text="Tools:"/>
		<mx:Button label="Zoom (Ctrl)"
				selected="{!m_ilz.requireCtrlKey}"
				click="m_ilp.requireShiftKey = true; m_ilz.requireCtrlKey = !m_ilz.requireCtrlKey;"/>
		<mx:Button label="Zoom 100%"
				click="m_iw.setViewFullExtent()"/>
		<mx:Button label="Pan (Shift)"
				selected="{!m_ilp.requireShiftKey}"
				click="m_ilz.requireCtrlKey = true; m_ilp.requireShiftKey = !m_ilp.requireShiftKey;" />

		<mx:Label text="Projections:"/>
		<mx:Button label="LatLon"
				selected="{m_iw.crs == 'EPSG:4326'}" 
				click="m_iw.setCRS('EPSG:4326', false); m_iw.setExtentBBOXRaw(-180,-90,180,90);"/>
		<mx:Button label="Mercator"
				selected="{m_iw.crs == 'EPSG:54004'}" 
				click="m_iw.setCRS('EPSG:54004', false); m_iw.setExtentBBOXRaw(0,-13000000,36000000,13000000);"/>
		<mx:Button label="North Polar Stereo"
				selected="{m_iw.crs == 'EPSG:102018'}" 
				click="m_iw.setCRS('EPSG:102018', false); m_iw.setExtentBBOXRaw(-10000000,-10000000,10000000,10000000);"/>
		<mx:Button label="South Polar Stereo"
				selected="{m_iw.crs == 'EPSG:102021'}" 
				click="m_iw.setCRS('EPSG:102021', false); m_iw.setExtentBBOXRaw(-10000000,-10000000,10000000,10000000);"/>
	</mx:HBox>
	<mx:VBox width="100%" height="100%">
		<widgets:InteractiveWidget id="m_iw" width="100%" height="100%">
			<widgets:InteractiveLayerZoom id="m_ilz" zOrder="1"/>
			<widgets:InteractiveLayerPan id="m_ilp" zOrder="2"/>
		</widgets:InteractiveWidget>
	</mx:VBox>
</mx:Application>
